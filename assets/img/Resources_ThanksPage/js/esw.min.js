!function(e){function t(){var e,t=!1;this.settings={appendHelpButton:!0,displayHelpButton:!0,isExternalPage:!0,devMode:!1,targetElement:document.body,elementForOnlineDisplay:void 0,elementForOfflineDisplay:void 0,defaultMinimizedText:"",disabledMinimizedText:"",defaultAssistiveText:"",loadingText:"Loading",showIcon:void 0,enabledFeatures:[],entryFeature:"FieldService",storageDomain:document.domain,language:void 0,linkAction:{feature:void 0,name:void 0,valid:!1},linkActionParameters:{},useCustomAuthentication:!1,allowGuestUsers:!1,requireSLDS:!1},this.auth={},this.validLinkActions={},this.alwaysWarnOnBeforeUnload=!1,Object.defineProperty(this.auth,"oauthToken",{get:function(){return e},set:function(t){this.validateHeaderValue(t)?(e=t)?(this.setSessionData("ESW_OAUTH_TOKEN",t),this.checkAuthentication()):this.deleteSessionData("ESW_OAUTH_TOKEN"):this.error('"'+t+'" is not a valid OAuth token.')}.bind(this)}),this.featureScripts={},this.storedEventHandlers={},this.messageHandlers={},this.storageKeys=["ESW_BODY_SCROLL_POSITION","ESW_IS_MINIMIZED","ESW_MINIMIZED_TEXT","ESW_OAUTH_TOKEN"],this.defaultSettings={},this.snippetSettingsFile={},this.eswFrame=void 0,this.availableFeatures=["script","session"],this.outboundMessagesAwaitingIframeLoad=[],this.pendingMessages={},this.iframeScriptsToLoad=[],this.isAuthenticationRequired=this.isIframeReady=this.hasSessionDataLoaded=this.componentInitInProgress=this.domInitInProgress=!1,this.loginPendingSerializedData=void 0,this.componentLoaded=!1,Object.defineProperty(this,"isButtonDisabled",{get:function(){return t},set:function(e){t=e,this.onButtonStatusChange()}.bind(this),configurable:!0}),this.setupMessageListener(),this.getLinkActionData()}var i=[".salesforce.com",".force.com",".sfdc.net"];t.prototype.getLightningOutParamsObj=function(){var e={};return embedded_svc.config&&embedded_svc.config.additionalSettings&&embedded_svc.config.additionalSettings.labelsLanguage?e={guestUserLang:embedded_svc.config.additionalSettings.labelsLanguage}:embedded_svc.settings.language&&""!==embedded_svc.settings.language.trim()&&(e={guestUserLang:embedded_svc.settings.language}),e.eswConfigDeveloperName=embedded_svc.settings.eswConfigDevName,e},t.prototype.adjustCommunityStorageDomain=function(){this.isCommunityDomain(this.settings.storageDomain)&&this.settings.storageDomain===document.domain&&(this.settings.storageDomain=this.settings.storageDomain+"/"+window.location.pathname.split("/")[1])},t.prototype.loadLightningOutScripts=function(e){if("function"==typeof Promise)return new Promise(function(t,i){try{var n=e&&e.baseCoreURL?e.baseCoreURL:embedded_svc.settings.baseCoreURL;if(window.$Lightning)t("Lightning Out is already loaded on this page.");else if(embedded_svc.utils.isCommunityOrSite())t("Communities context does not require Lightning Out to use Embedded Service.");else if(n){var s=document.createElement("script");s.type="text/javascript",s.src=n+"/lightning/lightning.out.js",s.onload=function(){t("Lightning Out scripts loaded.")},document.getElementsByTagName("head")[0].appendChild(s)}}catch(e){i(e)}});this.loadScriptFromDirectory("common","promisepolyfill",function(){return this.loadLightningOutScripts(e)}.bind(this),!0)},t.prototype.instantiateLightningOutApplication=function(e){if("function"==typeof Promise)return new Promise(function(t,i){try{var n=e&&e.communityEndpointURL?e.communityEndpointURL:embedded_svc.settings.communityEndpointURL,s=e&&e.oauthToken?e.oauthToken:embedded_svc.settings.oauthToken,o=e&&e.paramsObj?e.paramsObj:embedded_svc.getLightningOutParamsObj()||void 0;embedded_svc.utils.isCommunityOrSite()?t("Communities context already has an Aura context."):window.$Lightning&&$Lightning.use("embeddedService:sidebarApp",function(){t("Lightning Out application request complete.")},n,s,o)}catch(e){i(e)}});this.loadScriptFromDirectory("common","promisepolyfill",function(){return this.instantiateLightningOutApplication(e)}.bind(this),!0)},t.prototype.createEmbeddedServiceComponent=function(e){if("function"==typeof Promise)return new Promise(function(t,i){var n=e&&e.chatAPISettings?embedded_svc.validateStartChatAttributes(e.chatAPISettings):{};try{var s=e&&e.attributes?e.attributes:{configurationData:embedded_svc.settings,chatAPISettings:n},o=e&&e.locator?e.locator:embedded_svc.settings.targetElement;embedded_svc.preparePageForSidebar(),window.$Lightning&&!document.querySelector(".embeddedServiceSidebar")?$Lightning.ready($Lightning.createComponent.bind(this,"embeddedService:sidebar",s,o,function(e,n,s){"SUCCESS"===n?embedded_svc.utils.addEventHandler("afterInitialization",function(){t("Embedded Service component created.")}):i(s)})):embedded_svc.utils.isCommunityOrSite()?window.dispatchEvent(new CustomEvent("embeddedServiceCreateSidebar",{detail:{componentAttributes:s,resolve:t,reject:i}})):void 0===window.$Lightning?t("Lightning Out should be loaded on this page before creating the Embedded Service component."):t("Embedded Service component already exists.")}catch(e){i(e)}});this.loadScriptFromDirectory("common","promisepolyfill",function(){return this.createEmbeddedServiceComponent(e)}.bind(this),!0)},t.prototype.bootstrapEmbeddedService=function(e){if("function"==typeof Promise)return new Promise(function(t,i){try{embedded_svc.loadLightningOutScripts(e).then(function(){embedded_svc.instantiateLightningOutApplication(e).then(function(){embedded_svc.createEmbeddedServiceComponent(e).then(function(){window.requestAnimationFrame(function(){embedded_svc.hideHelpButton(),t("Embedded Service application and component bootstrapped.")})})})})}catch(e){i(e)}});this.loadScriptFromDirectory("common","promisepolyfill",function(){return embedded_svc.bootstrapEmbeddedService(e)},!0)},t.prototype.validateStartChatAttributes=function(e){var t=(e=e||{})&&e.prepopulatedPrechatFields?e.prepopulatedPrechatFields:{},i=e&&e.extraPrechatInfo?e.extraPrechatInfo:[],n=e&&e.extraPrechatFormDetails?e.extraPrechatFormDetails:[],s=e&&e.fallbackRouting?e.fallbackRouting:[],o=e&&e.directToButtonRouting?e.directToButtonRouting:void 0,a={buttonId:e&&e.buttonId?e.buttonId:void 0,userId:e&&e.userId?e.userId:void 0,fallback:e&&"boolean"==typeof e.fallback?e.fallback:void 0};if("object"!=typeof t)throw Error("Validation failed for prepopulatedPrechatFields, received: "+t);if(e.prepopulatedPrechatFields=t,!Array.isArray(n))throw Error("Validation failed for extraPrechatFormDetails, received: "+n);if(e.extraPrechatFormDetails=n,!Array.isArray(i))throw Error("Validation failed for extraPrechatInfo, received: "+i);if(e.extraPrechatInfo=i,!Array.isArray(s))throw Error("Validation failed for fallbackRouting, received: "+s);if(e.fallbackRouting=s,"function"==typeof o?e.directToButtonRouting=o:embedded_svc.log("Did not receive an actionable parameter for directToButtonRouting, received: "+o),"object"!=typeof a)throw Error("Validation failed for directToAgentRouting, received: "+a);if(e.directToAgentRouting=a,a.buttonId){if("string"!=typeof a.buttonId||!a.buttonId.trim().length)throw Error("Validation failed for directToAgentRouting's buttonId, received: "+a.buttonId);e.directToAgentRouting.buttonId=a.buttonId.trim(),e.directToAgentRouting.fallback=a.fallback,a.userId&&("string"==typeof a.userId&&a.userId.trim().length?e.directToAgentRouting.userId=a.userId.trim():embedded_svc.log("Did not receive an actionable parameter for directToAgentRouting's userId, received: "+a.userId))}else embedded_svc.log("Did not receive an actionable parameter for directToAgentRouting's buttonId, received: "+a.buttonId);return e},t.prototype.isInternetExplorer=function(){return"ActiveXObject"in window},t.prototype.outputToConsole=function(e,t,i){(i||this.settings.devMode)&&console&&console[e]&&console[e]("[Snap-ins] "+(Array.isArray(t)?t.join(", "):t))},t.prototype.log=function(){this.outputToConsole("log",[].slice.apply(arguments))},t.prototype.error=function(e,t){e?this.outputToConsole("error",e,t):this.outputToConsole("error","esw responed with an unspecified error.",t),embedded_svc.utils.fireEvent("error")},t.prototype.warning=function(e,t){e?this.outputToConsole("warn","Warning: "+e,t):this.outputToConsole("warn","esw sent an anonymous warning.",t)},t.prototype.deprecated=function(e){this.warning(e+" is deprecated in version "+Number("5.0").toFixed(1)+" and will be removed in version "+(Number("5.0")+1).toFixed(1))},t.prototype.getCookie=function(e){var t=document.cookie;if(t){var i=t.indexOf(e+"=");if(-1!==i)return i+=(e+"=").length,-1===(e=t.indexOf(";",i))&&(e=t.length),t.substring(i,e)}},t.prototype.setCookie=function(e,t,i){e=e+"="+t+";",i&&((i=new Date).setFullYear(i.getFullYear()+10),e+="expires="+i.toUTCString()+";"),document.cookie=e+"path=/;"},t.prototype.mergeSettings=function(e){Object.keys(e).forEach(function(t){void 0===this.settings[t]&&(this.settings[t]=e[t])}.bind(this))},t.prototype.loadFeatureScript=function(e,t){var i=decodeURI(e).toLowerCase();-1===e.indexOf("..")?this.loadScriptFromDirectory("client",i+".esw",function(){this.featureScripts[e](this),this.availableFeatures.push(i),embedded_svc.utils.fireEvent("featureLoaded",void 0,e),t&&t(),this.processPendingMessages(i)}.bind(this)):this.error('"'+e+'" is not a valid feature name.')},t.prototype.fireEvent=function(e,t){var i=[].slice.apply(arguments).slice(2);return window.embedded_svc&&embedded_svc.utils?embedded_svc.utils.fireEvent(e,t,i):(this.error("fireEvent should not be called before calling init!"),!0)},t.prototype.isValidEntityId=function(e){return"string"==typeof e&&(18===e.length||15===e.length)},t.prototype.getKeyPrefix=function(e){if(this.isValidEntityId(e))return e.substr(0,3)},t.prototype.isOrganizationId=function(e){return"00D"===this.getKeyPrefix(e)},t.prototype.getESWFrame=function(){var e=document.getElementById("esw_storage_iframe");return!this.eswFrame&&e&&(this.eswFrame=e.contentWindow),this.eswFrame},t.prototype.isFrameStorageEnabled=function(){return this.deprecated("isFrameStorageEnabled"),!0},t.prototype.processPendingMessages=function(e){this.pendingMessages[e]&&(this.pendingMessages[e].forEach(function(e){this.handleMessage(e.payload)}.bind(this)),this.pendingMessages[e]=void 0)},t.prototype.loadCSS=function(){var e=document.createElement("link");e.href=(this.settings.gslbBaseURL?this.settings.gslbBaseURL:this.settings.baseCoreURL)+"/embeddedservice/"+this.settings.releaseVersion+"/esw"+(this.settings.devMode?"":".min")+".css",e.type="text/css",e.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(e)},t.prototype.appendHelpButton=function(e){var t=document.createElement("div"),i="";t.className="embeddedServiceHelpButton",this.isLanguageRtl(this.settings.language)&&this.isDesktop()&&(i='dir="rtl"'),t.innerHTML='<div class="helpButton"'+i+'><button class="helpButtonEnabled uiButton" href="javascript:void(0)"><span class="embeddedServiceIcon" aria-hidden="true" data-icon="&#59648;"></span><span class="helpButtonLabel" id="helpButtonSpan" aria-live="polite" aria-atomic="true"><span class="assistiveText">'+(this.settings.defaultAssistiveText||"")+'</span><span class="message"></span></span></button></div>',e||(t.style.display="none"),this.settings.targetElement.appendChild(t),this.setHelpButtonText(this.settings.defaultMinimizedText),"ontouchstart"in document.documentElement&&[].slice.apply(document.querySelectorAll(".embeddedServiceHelpButton .uiButton")).forEach(function(e){e.classList.add("no-hover")}),this.onButtonStatusChange()},t.prototype.appendIFrame=function(){var e=document.createElement("iframe"),t={};e.id="esw_storage_iframe",e.src=this.settings.iframeURL,e.style.display="none",e.title="Live Chat Metadata",e.onload=function(){var e=this.getESWFrame();this.isIframeReady=!0,this.outboundMessagesAwaitingIframeLoad.forEach(function(t){e.postMessage(t,this.settings.iframeURL)}.bind(this)),this.outboundMessagesAwaitingIframeLoad=[],this.iframeScriptsToLoad.forEach(function(e){this.loadStorageScript(e)}.bind(this)),t.deploymentId=this.settings.deploymentId,t.isSamePageNavigation=this.isSamePageNavigation(),t.isRefresh=1===window.performance.navigation.type,this.postMessage("session.updateStorage",t),this.iframeScriptsToLoad=[]}.bind(this),this.settings.targetElement.appendChild(e),window.addEventListener("beforeunload",function(t){if(this.isInternetExplorer()&&(e.src="about:blank"),this.warnOnBeforeUnload&&this.componentLoaded){if(embedded_svc.utils.fireEvent("snapinsCloseSessionWarning"),!this.settings.closeSessionWarning||"function"!=typeof this.settings.closeSessionWarning)return(t||window.event).returnValue="You might lose the active chat session if you close this tab. Are you sure?";this.settings.closeSessionWarning()}}.bind(this),!1)},t.prototype.preparePageForSidebar=function(){document.getElementById("snapins_invite")&&embedded_svc.inviteAPI&&embedded_svc.inviteAPI.inviteButton.setOnlineState(!1),embedded_svc.utils.fireEvent("beforeCreate"),Object.keys(this.settings).forEach(function(e){}.bind(this)),this.mergeSettings(this.defaultSettings)},t.prototype.createLightningComponent=function(e){this.preparePageForSidebar(),this.createEmbeddedServiceComponent({attributes:{configurationData:this.settings,serializedSessionData:e},locator:this.settings.targetElement}).then(function(){this.hideHelpButton(),this.componentInitInProgress=!1,this.componentLoaded=!0,this.setHelpButtonText(this.settings.defaultMinimizedText),embedded_svc.utils.fireEvent("ready")}.bind(this))},t.prototype.loadLightningApp=function(e){var t;if(this.settings.isExternalPage&&"string"!=typeof this.settings.communityEndpointURL)throw Error("communityEndpointURL String property not set");if(t=document.getElementsByClassName("helpButton")[0]){var i=t.getBoundingClientRect().width;0<i&&(t.style.width=i+"px")}this.setHelpButtonText(this.settings.loadingText,!1),this.instantiateLightningOutApplication({communityEndpointURL:this.settings.communityEndpointURL,oauthToken:this.auth.oauthToken}).then(this.createLightningComponent.bind(this,e))},t.prototype.initLightningOut=function(e){this.hasSessionDataLoaded&&("function"!=typeof Promise?this.loadScriptFromDirectory("common","promisepolyfill",function(){this.initLightningOut(e)}.bind(this),!0):this.loadLightningOutScripts().then(this.loadLightningApp.bind(this,e)))},t.prototype.setHelpButtonText=function(e,t){var i=void 0===this.settings.showIcon||this.settings.showIcon;(t=void 0===t?i:t,i=document.getElementById("helpButtonSpan"))&&(i.querySelector(".message").innerHTML=e,(e=i.parentElement.querySelector(".embeddedServiceIcon"))&&(e.style.display=t?"inline-block":"none"))},t.prototype.prepareDOM=function(){this.domInitInProgress||(this.domInitInProgress=!0,this.appendIFrame())},t.prototype.addSessionHandlers=function(){this.addMessageHandler("session.onLoad",function(){this.postMessage("session.get",this.storageKeys)}.bind(this)),this.addMessageHandler("session.sessionData",function(e){this.alwaysWarnOnBeforeUnload=!e,this.resumeInitWithSessionData(e||{})}.bind(this)),this.addMessageHandler("session.deletedSessionData",function(e){-1<e.indexOf("CHASITOR_SERIALIZED_KEY")&&(this.loginPendingSerializedData=void 0)}.bind(this)),this.addMessageHandler("session.updatePrimary",function(e){e&&(e.isPrimary?sessionStorage.setItem(this.settings.storageDomain+"MASTER_DEPLOYMENT_ID",this.settings.deploymentId):sessionStorage.removeItem(this.settings.storageDomain+"MASTER_DEPLOYMENT_ID"),this.warnOnBeforeUnload=this.alwaysWarnOnBeforeUnload||1<e.activeChatSessions&&e.isPrimary,embedded_svc&&embedded_svc.liveAgentAPI&&(embedded_svc.liveAgentAPI.browserSessionInfo=e))}.bind(this))},t.prototype.addMetaTag=function(e,t){var i=document.createElement("meta");i.name=e,i.content=t,document.head.appendChild(i)},t.prototype.init=function(e,t,i,n,s,o){if(this.settings.baseCoreURL=e,this.settings.communityEndpointURL=t,this.settings.gslbBaseURL=i||e,this.settings.orgId=n,this.settings.releaseVersion="5.0",this.settings.eswConfigDevName=s,this.mergeSettings(o||{}),this.adjustCommunityStorageDomain(),"string"!=typeof this.settings.baseCoreURL)throw Error("Base core URL value must be a string.");if(!this.isOrganizationId(this.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+this.settings.orgId);embedded_svc.utils?this.finishInit():this.loadScriptFromDirectory("utils","common",this.finishInit.bind(this))},t.prototype.finishInit=function(){if(this.storedEventHandlers&&(Object.getOwnPropertyNames(this.storedEventHandlers).forEach(function(e){this.storedEventHandlers[e].forEach(function(t){embedded_svc.utils.addEventHandler(e,t)})}.bind(this)),this.storedEventHandlers={}),!embedded_svc.utils.fireEvent("validateInit",function(e){return-1!==e.indexOf(!1)},this.settings)){if(this.checkForNativeFunctionOverrides(),this.settings.appendHelpButton&&this.loadCSS(),!this.settings.targetElement)throw Error("No targetElement specified");this.settings.iframeURL=this.settings.gslbBaseURL+"/embeddedservice/"+this.settings.releaseVersion+(this.settings.devMode?"/eswDev.html":"/esw.html")+"?parent="+document.location.href,this.addSessionHandlers(),this.loadFeatures(this.onFeatureScriptsLoaded.bind(this)),embedded_svc.utils.fireEvent("afterInit",void 0,this.settings)}},t.prototype.onFeatureScriptsLoaded=function(){"complete"===document.readyState?setTimeout(this.prepareDOM.bind(this),1):document.addEventListener?(document.addEventListener("DOMContentLoaded",this.prepareDOM.bind(this),!1),window.addEventListener("load",this.prepareDOM.bind(this),!1)):window.attachEvent?window.attachEvent("onload",this.prepareDOM.bind(this)):this.log("No available event model. Exiting.")},t.prototype.checkForNativeFunctionOverrides=function(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout".split(" ")}].forEach(function(e){e.functions.forEach(function(t){t in e.object&&!this.isNativeFunction(e.object,t)&&this.warning("Embedded Service Chat may not function correctly with this native JS function modified: "+e.name+"."+t,!0)}.bind(this))}.bind(this))},t.prototype.isNativeFunction=function(e,t){return Function.prototype.toString.call(e[t]).match(/\[native code\]/)},t.prototype.onHelpButtonClick=function(){if(!this.componentInitInProgress&&!document.getElementsByClassName("embeddedServiceSidebar").length){this.componentInitInProgress=!0;try{embedded_svc.utils.isCommunityOrSite()&&0<Object.keys(embedded_svc.liveAgentAPI.inviteButton).length?window.dispatchEvent(new CustomEvent("onStartChatFromInvitation"),{detail:{bubbles:!0,composed:!1}}):(this.checkAuthentication(),embedded_svc.utils.fireEvent("onHelpButtonClick"))}catch(e){throw this.componentInitInProgress=!1,e}}},t.prototype.resumeInitWithSessionData=function(e){var t=embedded_svc.utils.fireEvent("sessionDataRetrieved",function(e){return-1!==e.indexOf(!0)},e),i=!1,n=!1;this.settings.linkAction.valid?i=!0:t?(this.log("Existing session found. Continuing with data: "+e),n=i=!0,embedded_svc.menu&&embedded_svc.menu.hideTopContainer()):this.componentInitInProgress&&(i=!0),this.hasSessionDataLoaded=!0,e.ESW_OAUTH_TOKEN&&(this.auth.oauthToken=e.ESW_OAUTH_TOKEN),this.loginPendingSerializedData=n?e:void 0,i&&(this.componentInitInProgress=!0,this.checkAuthentication()),this.settings.appendHelpButton&&this.appendHelpButton(this.settings.displayHelpButton&&!t)},t.prototype.checkAuthentication=function(){this.isAuthenticationRequired&&!this.settings.allowGuestUsers?this.auth.oauthToken?(this.loginButtonPressed||this.componentInitInProgress)&&this.initLightningOut(this.loginPendingSerializedData):embedded_svc.utils.fireEvent("requireauth"):(this.loginButtonPressed||this.componentInitInProgress)&&this.initLightningOut(this.loginPendingSerializedData)},t.prototype.postMessage=function(e,t){e={domain:this.settings.storageDomain,data:t,method:e},(t=this.getESWFrame())?t.postMessage(e,this.settings.iframeURL):this.outboundMessagesAwaitingIframeLoad.push(e)},t.prototype.setSessionData=function(e,t){if("object"==typeof e)var i=e;else(i={})[e]=t;this.postMessage("session.set",i)},t.prototype.deleteSessionData=function(e){e=Array.isArray(e)?e:[e],this.postMessage("session.delete",e)},t.prototype.defineFeature=function(e,t){this.featureScripts[e]=t},t.prototype.registerStorageKeys=function(e){"string"==typeof e?this.storageKeys.push(e):e.forEach(function(e){this.storageKeys.push(e)}.bind(this))},t.prototype.addMessageHandler=function(e,t){this.messageHandlers[e]||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)};var n="liveagent.chatCanceledOnDifferentTab liveagent.fileTransfer.resetFileSelector liveagent.fileTransfer.uploadFile session.deletedSessionData session.onLoad session.sessionData session.updateMaster".split(" ");t.prototype.clearMessageHandlers=function(){Object.keys(this.messageHandlers).filter(function(e){return-1===n.indexOf(e)}).forEach(function(e){this.messageHandlers[e]=[]}.bind(this))},t.prototype.loadStorageScript=function(e){this.isIframeReady?this.postMessage("script.load",e):this.iframeScriptsToLoad.push(e)},t.prototype.loadScriptFromDirectory=function(e,t,i,n){t=t.toLowerCase();var s=document.createElement("script"),o=this.settings.gslbBaseURL,a=t.replace(".","-")+"-script";s.id=a,s.type="text/javascript",s.src=[o,"embeddedservice",n?void 0:this.settings.releaseVersion,e,t+(this.settings.devMode?"":".min")+".js"].filter(function(e){return!!e}).join("/"),i&&(s.onload=i),document.body.appendChild(s)},t.prototype.loadFeatures=function(e){this.settings.enabledFeatures.forEach(function(t){"base"!==t&&-1===this.availableFeatures.indexOf(t.toLowerCase())&&this.loadFeatureScript(t,e)}.bind(this))},t.prototype.addEventHandler=function(e,t){window.embedded_svc&&embedded_svc.utils?embedded_svc.utils.addEventHandler(e,t):(this.storedEventHandlers[e]||(this.storedEventHandlers[e]=[]),this.storedEventHandlers[e].push(t))},t.prototype.setupMessageListener=function(){window.addEventListener("message",function(e){var t=e.data,i=e.origin.split(":")[1].replace("//","");t&&t.method&&embedded_svc.isMessageFromSalesforceDomain(i)&&("session.onLoad"===t.method&&-1===this.settings.iframeURL.indexOf(i)&&(i=this.settings.iframeURL.split("/")[2],e=e.origin.split("/")[2],this.settings.iframeURL=this.settings.iframeURL.replace(i,e)),e=t.method.split(".")[0].toLowerCase(),-1===this.availableFeatures.indexOf(e)?(this.pendingMessages[e]||(this.pendingMessages[e]=[]),this.pendingMessages[e].push({direction:"incoming",payload:t})):this.handleMessage(t))}.bind(this),!1)},t.prototype.handleMessage=function(e){var t=this.messageHandlers[e.method];t?t.forEach(function(t){t(e.data)}):this.log("Unregistered method "+e.method+" received.")},t.prototype.isMessageFromSalesforceDomain=function(e){if(embedded_svc.utils.isCommunityOrSite()&&e===document.domain)return!0;return i.some(function(t){return function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(e,t)})},t.prototype.isCommunityDomain=function(e){return".force.com"===e.substr(-10)},t.prototype.isSamePageNavigation=function(){var e=document.domain;if(this.isCommunityDomain(document.domain)){var t=e+"/"+window.location.pathname.split("/")[1];t===this.settings.storageDomain&&(e=t)}return e.substr(-this.settings.storageDomain.length)===this.settings.storageDomain},t.prototype.addDefaultSetting=function(e,t){this.defaultSettings[e]=t},t.prototype.onButtonStatusChange=function(){var e,t=document.querySelector(".embeddedServiceHelpButton button");embedded_svc.menu&&embedded_svc.menu.onAgentAvailabilityChange(),t&&(e=t.querySelector(".message"))&&(this.isButtonDisabled?(t.onclick=function(){},t.classList.remove("helpButtonEnabled"),t.classList.add("helpButtonDisabled"),e.innerHTML=this.settings.disabledMinimizedText):(t.onclick=this.onHelpButtonClick.bind(this),t.classList.remove("helpButtonDisabled"),t.classList.add("helpButtonEnabled"),e.innerHTML=this.settings.defaultMinimizedText))},t.prototype.hideHelpButton=function(){var e=document.querySelector(".embeddedServiceHelpButton");e&&(e.style.display="none")},t.prototype.showHelpButton=function(){var e=document.querySelector(".embeddedServiceHelpButton");e&&(e.style.display="")},t.prototype.setDefaultButtonText=function(e,t,i,n){this.settings.entryFeature===e&&(this.settings.defaultMinimizedText=this.settings.defaultMinimizedText||t,this.settings.disabledMinimizedText=this.settings.disabledMinimizedText||i,this.settings.defaultAssistiveText=this.settings.defaultAssistiveText||n||"")},t.prototype.setDefaultShowIcon=function(e,t){this.settings.entryFeature===e&&void 0===this.settings.showIcon&&(this.settings.showIcon=t)},t.prototype.registerLinkAction=function(e,t){var i=this.settings.linkAction;this.validLinkActions[e]||(this.validLinkActions[e]=[]),-1===this.validLinkActions[e].indexOf(t)&&this.validLinkActions[e].push(t),i.feature&&i.name&&i.feature.toLowerCase()===e.toLowerCase()&&i.name.toLowerCase()===t.toLowerCase()&&(i.valid=!0,i.feature=e,this.settings.entryFeature=e)},t.prototype.setLinkAction=function(e,t,i){var n=Object.keys(this.validLinkActions).filter(function(t){return t.toLowerCase()===e.toLowerCase()})[0];n?(this.settings.linkAction.feature=n,this.settings.linkAction.name=this.validLinkActions[n].filter(function(e){return e.toLowerCase()===t.toLowerCase()})[0],this.settings.linkAction.valid=void 0!==this.settings.linkAction.name,this.settings.linkActionParameters=i):this.settings.linkAction.valid=!1},t.prototype.getLinkActionData=function(){window.location.search.replace(/([a-zA-Z0-9._]+)=([^&\s]+)/g,function(e,t,i){0===(e=t.toLowerCase()).indexOf("snapins.")&&("action"===(e=e.replace("snapins.",""))?2===(i=i.split(".")).length&&(this.settings.linkAction.feature=i[0],this.settings.linkAction.name=i[1]):this.settings.linkActionParameters[e.toLowerCase()]=i)}.bind(this))},t.prototype.requireAuthentication=function(){var e=document.createElement("script"),t=document.createElement("style"),i=document.querySelector(this.settings.loginTargetQuerySelector);if(this.isAuthenticationRequired=!0,"https:"!==window.location.protocol&&!this.settings.devMode)throw this.settings.displayHelpButton=!1,Error("Snap-in authentication requires HTTPS.");if(!this.settings.useCustomAuthentication){if(!this.settings.loginClientId||!this.settings.loginRedirectURL||!this.settings.loginTargetQuerySelector)throw Error("Authentication in Snap-ins requires these valid settings params: loginClientId, loginRedirectURL, loginTargetQuerySelector.");if(!i)throw Error("loginTargetQuerySelector is not a valid DOM element.");this.loginButtonPressed=!1,i.addEventListener("click",function(){this.loginButtonPressed=!0}.bind(this)),this.addMetaTag("salesforce-community",this.settings.communityEndpointURL),this.addMetaTag("salesforce-client-id",this.settings.loginClientId),this.addMetaTag("salesforce-redirect-uri",this.settings.loginRedirectURL),this.addMetaTag("salesforce-mode","popup"),this.addMetaTag("salesforce-target",this.settings.loginTargetQuerySelector),this.addMetaTag("salesforce-login-handler","__snapinsLoginCallback"),this.addMetaTag("salesforce-logout-handler","__snapinsLogoutCallback"),embedded_svc.utils.addEventHandler("requireauth",function(){var e=setInterval(function(){window.SFIDWidget&&(clearInterval(e),window.SFIDWidget.openid_response?window.__snapinsLoginCallback():window.SFIDWidget.login())},100)}),embedded_svc.utils.addEventHandler("autherror",function(e){if(window.SFIDWidget){this.loginButtonPressed=!0,window.SFIDWidget.logout();var t=setInterval(function(){window.SFIDWidget.config&&(clearInterval(t),embedded_svc.utils.fireEvent("requireauth"))}.bind(this,t),100)}}.bind(this)),window.__snapinsLoginCallback=function(){var e=document.querySelector(this.settings.loginTargetQuerySelector),t=document.createElement("button");(this.loginButtonPressed||this.componentInitInProgress)&&(e.innerHTML=""),t.className="authenticationStart",t.innerHTML=this.settings.authenticationStartLabel,t.addEventListener("click",this.onHelpButtonClick.bind(this)),e.appendChild(t),this.auth.oauthToken=window.SFIDWidget.openid_response.access_token}.bind(this),window.__snapinsLogoutCallback=function(){this.auth.oauthToken=void 0,window.SFIDWidget.init()}.bind(this),document.head.appendChild(t),t.sheet.insertRule(".sfid-logout { display: none; }",0),e.type="text/javascript",e.src=this.settings.communityEndpointURL+"/servlet/servlet.loginwidgetcontroller?type=javascript_widget"+(embedded_svc.settings.devMode?"&min=false":""),document.head.appendChild(e)}},t.prototype.requireSLDS=function(){if(this.settings.requireSLDS=!0,this.settings.targetElement===document.body){var e=document.createElement("div");e.id="esw-snapin-target",document.body.appendChild(e),this.settings.targetElement=e}this.settings.targetElement.classList.add("slds-scope"),(e=document.createElement("link")).href=(this.settings.gslbBaseURL?this.settings.gslbBaseURL:this.settings.baseCoreURL)+"/embeddedservice/"+this.settings.releaseVersion+"/esw-slds"+(this.settings.devMode?"":".min")+".css",e.type="text/css",e.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(e)},t.prototype.validateHeaderValue=function(e){return/^[0-9a-zA-Z!#$%&'*+-.^_`|~" ]*$/g.test(e)},t.prototype.isLanguageRtl=function(e){if(e&&""!==e.trim())switch(e.substring(0,2)){case"ar":case"fa":case"he":case"iw":case"ji":case"ur":case"yi":return!0;default:return!1}},t.prototype.isDesktop=function(){return-1===navigator.userAgent.indexOf("Mobi")},window.embedded_svc=new t,Object.getOwnPropertyNames(e).forEach(function(t){var i=e[t];"object"===i?(window.embedded_svc[t]={},Object.keys(i).forEach(function(e){window.embedded_svc[t][e]=i[e]})):window.embedded_svc[t]=i})}(window.embedded_svc||{});